
{% extends "base.html.twig" %}

{% block stylesheets %}
            <!-- Font Awesome -->
            <link rel="stylesheet" href="{{ asset('adminLTE/plugins/fontawesome-free/css/all.min.css') }}">
            <!-- Ionicons -->
            <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
            <!-- Theme style -->
            <link rel="stylesheet" href="{{ asset('adminLTE/dist/css/adminlte.min.css') }}">
            <!-- Google Font: Source Sans Pro -->
            <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">		
            <!-- Datiuser style-->
	        <link href="{{ asset('assets/css/confirm-user-popup.css') }}" rel="stylesheet">
            <!-- Numeric Keypad -->
            <link href="{{ asset('assets/css/jquery.keypad.css') }}" rel="stylesheet">
            <!-- International Telephone Input -->
            <link href="{{ asset('assets/css/intlTelInput/intlTelInput.css') }}" rel="stylesheet">
{% endblock %}

{% block head_javascripts %}
            <!-- Sweet alert scripts-->
            <script src="{{ asset('assets/js/sweetalert2/sweetalert2.all.min.js') }}"></script>	
            <script src="{{ asset('assets/js/sweetalert2/sweetalert2.min.js') }}"></script>
{% endblock %}

{% block body %}
<div class="chat-popup" id="daticash_connexion_popUp">
    <div id="ib-center" class="dati_popup">
        <div class="container">
            <div class="row d-flex justify-content-center">
                <div class="login-box" style="min-width: 285px; position: absolute;left: 5%;top: 5%;">
                    <div class="login-logo">
                        <a href="http://daticash.com/" target="_blank" style="color: #fff;">
                            <img src="{{ absolute_url(asset("assets/img/Daticash5.png")) }}" style="width: 100%" />
                        </a>
                    </div>
                    <div class="login-feedback">{% if error %}
                            <div class="alert alert-danger">{{ error.messageKey|trans(error.messageData, 'security') }}</div>
                        {% endif %}
                        {% if app.user %}
                            <div class="mb-3">
                                You are logged in as {{ app.user.username }}, <a href="{{ path('app_logout') }}">Logout</a>
                            </div>
                        {% endif %}</div>
                    <div class="card body_card_daticash_login">
                    <div class="card-body login-card-body" style="background-color: rgba(255, 255, 255, 0);">								  
                        <small id="allow_reset-feedback"></small>
                        <form method="post" class="form login-form">
                        <label for="phone_number" style="width: 100%; margin-bottom: .5rem;">
                            <font style="vertical-align: inherit;">Phone number&nbsp</font>
                            <small id="phone-feedback" style="display: block;"></small>												
                        </label>
                        <div class="input-group mb-3 form-daticash_phone">
                            <input type="hidden" class="form-control" id="country_code" name="country_code" value="237" >
                            <input type="phone_number" class="form-control" id="phone_number" name="phone_number" >
                            <div class="input-group-append" id="input_group_appendto_phone" name="input_group_appendto_phone">
                            <div class="input-group-text">
                                <span class="fas fa-user"></span>
                            </div>
                            </div>
                        </div>
                        
                        <div class="login_pin_code-group">	
                            <label for="pin_code" style="width: 100%; margin-bottom: .5rem;">
                                <font style="vertical-align: inherit;">PIN Code&nbsp</font>
                                <small id="pin_code-feedback" style = "display: inline-block"></small>
                            </label>
                            <small class="show_or_hide_pin_js" style="margin-top: 4px;color: #0a4f68;position: absolute;right: 20px;">
                            <i class="show_or_hide_pin_text_js">Show</i><input type="checkbox" id="show_hide_pin" style="vertical-align: text-bottom;margin-left: 5px;color: #777777;font-weight: 100;"></small>												
                            <div class="input-group mb-3">
                                <input type="password" class="form-control" id="password" name="password" placeholder="PIN" maxlength="6">
                                <div class="input-group-append">
                                <div class="input-group-text">
                                    <span class="fas fa-key"></span>
                                </div>
                                </div>
                            </div>
                        </div>
                        <div id="re_captcha_container" class="text-center mb-2">
                            <div id="g-recaptcha"></div>
                        </div>
                        <hr>
                        <div class="row">
                            <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">
                            {#
                                If you want to control the URL the user
                                is redirected to on success (more details below)
                                <input type="hidden" name="_target_path" value="/account"/>
                            #}
                            <div class="checkbox mb-3">
                                <label>
                                    <input type="checkbox" name="_remember_me"> Resté connecté
                                </label>
                            </div>
                            <div class="col-12 form-group_daticash_login_btn">
                            <input type="hidden" name="action" class="action" value="daticash_login">
                            <button type="submit" class="daticash_btn btn-daticash btn-block" id="daticash_login_btn" name="daticash_login_btn" >Login</button>
                            </div>
                        </div>
                        </form>
                        <div class="row reset_js"> 
                            <div class="col-12 mb-3" style="font-weight: 700;color: #007bff;color: #007bff;" ><p class="text-right" style="display: inline;color: #777777;font-weight: 100;"></p><p style="cursor:pointer;display: inline;color: #0a4f68;;" id="daticash_allow_reset_pin" name="daticash_allow_reset_pin">PIN forgotten?</p></div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
            <!-- Bootstrap 4 -->
            <script src="{{ asset('adminLTE/plugins/bootstrap/js/bootstrap.bundle.min.js') }}"></script>
            <!-- Waves Effect Plugin Js -->
            <script src="{{ asset('adminLTE/plugins/node-waves/waves.js') }}"></script>
            <!-- AdminLTE App -->
            <script src="{{ asset('adminLTE/dist/js/adminlte.js') }}"></script>
            <!-- AdminLTE for demo purposes -->
            <script src="{{ asset('adminLTE/dist/js/demo.js') }}"></script> 
            <!-- numeric keypad jQuery-->
            <script src="{{ asset('assets/js/jquery.plugin.min.js') }}"></script>
            <!-- numeric keypad script-->
            <script src="{{ asset('assets/js/jquery.keypad.js') }}"></script>
            <!-- International Telephone Input-->	
            <script src="{{ asset('assets/js/intlTelInput/intlTelInput.js') }}"></script>
    <script type="text/javascript">

        var daticash_current_phone_number;
        function configure_intlTelInput(){
            var phone_number = document.querySelector("#phone_number");
            daticash_current_phone_number = window.intlTelInput(phone_number, {
                // allowDropdown: false,
                // autoHideDialCode: false,
                // autoPlaceholder: "off",
                // dropdownContainer: document.body,
                // excludeCountries: ["us"],
                // formatOnDisplay: false,
                geoIpLookup: function(callback) {
                    $.get("http://ipinfo.io", function() {}, "jsonp").always(function(resp) {
                        var countryCode = (resp && resp.country) ? resp.country : "";
                        callback(countryCode);
                    });
                },
                // hiddenInput: "full_number",
                // initialCountry: "auto",
                // localizedCountries: { 'de': 'Deutschland' },
                nationalMode: true,
                // onlyCountries: ['cm', 'ng', 'eg', 'ci', 'sn'],
                // placeholderNumberType: "MOBILE",
                // preferredCountries: ['cn', 'jp'],
                separateDialCode: true,
                utilsScript: "{{ absolute_url(asset("assets/js/intlTelInput/utils.js")) }}",//get value
            });

            var output = document.querySelector("#phone-feedback");

            var handleChange = function() {
                //impose the numeric characters
                var value = jQuery(this).val();
                value = value.replace(/[^0-9]+/g, '');
                jQuery(this).val(value);

                //show message if incorrect phone number
                var text = (daticash_current_phone_number.isValidNumber()) ? 'International: ' + daticash_current_phone_number.getNumber() + ' ✓ Valid': "Please enter a valid number below";
                var textNode = document.createTextNode(text);
                output.innerHTML = "";
                output.appendChild(textNode);

                /* change style color*/
                if(daticash_current_phone_number.isValidNumber()){
                    $("#phone-feedback").attr("class",'text-success');
                    $("#phone_number").removeClass("error").addClass("success");

                }else{
                    $("#phone-feedback").attr("class",'text-danger');
                    $("#phone_number").addClass("error").removeClass("success");
                    $(this).parent().find("#input-group-text").css("color: #ff7c7c; border-color:#ff7c7c");
                }

            };

            // listen to "keyup", but also "change" to update when the user selects a country
            phone_number.addEventListener('change', handleChange);
            phone_number.addEventListener('keyup', handleChange);
        }

        function autoChoose_country_code(country_code){
            configure_intlTelInput()
            $("#input_group_appendto_phone").remove()
            $('#phone_number').after('<div class="input-group-append"><div class="input-group-text" style="border-bottom-left-radius: 0;border-top-left-radius: 0;"><span class="fas fa-phone"></span></div></div>');

            $(".iti__selected-flag").trigger("click");
            $(".iti__country[data-dial-code='"+country_code+"']").trigger("click");
        }


        $(document).ready(function(){
            $('<div />').prependTo('body').prop('id', 'body_mask').addClass("body_mask");

            $('.show_or_hide_pin_js').remove();
            $('.new_pin_code-group').remove();
            $('.retype_new_pin_code-group').remove();

            configure_intlTelInput()
            $("#input_group_appendto_phone").remove()
            $('#phone_number').after('<div class="input-group-append"><div class="input-group-text" style="border-bottom-left-radius: 0;border-top-left-radius: 0;"><span class="fas fa-phone"></span></div></div>');

            $(".iti__selected-flag").trigger("click");
            $(".iti__country[data-dial-code='237']").trigger("click");

            //$("#username").prop('disabled', true);
            $('#password').keypad();
            /*Textbox Events*/
            $("body")
                .on('click', '.iti__country' , function(e) {
                    alert(recipient_country_code)

                    var sender_country_code = "1";
                    var recipient_country_code = "237";
                    var default_country_code = "cm";

                    var $this = $(this);
                    let _currency_received_txt = false;
                    default_country_code = $($this).attr("data-country-code");
                    var pid = $($this).attr("id")

                    sender_country_code = $this.find(".iti__dial-code").text();
                    sender_country_code = sender_country_code.substring(1, sender_country_code.length);

                    recipient_country_code = $this.find(".iti__dial-code").text();
                    recipient_country_code = recipient_country_code.substring(1, recipient_country_code.length);

                    if(_currency_received_txt = !$this.parents('.form-group-sender_phone').length){
                        $('#country_img').html("<img src='https://www.countryflags.io/"+default_country_code+"/flat/32.png'>");
                        $('#country_name').html($("#"+pid).children(".iti__country-name").text());
                    }
                    if(_currency_received_txt = $this.parents('.form-daticash_phone').length){
                        alert(recipient_country_code)
                        $('#country_code').val(recipient_country_code);
                    }
                    if(_currency_received_txt = $this.parents('.form-group_topup_by_mobile_money_source').length){
                        alert(recipient_country_code)
                        $('#topup_by_mobile_money_source_country_code').val(recipient_country_code);
                    }

                    //alert($this.parents('.form-daticash_phone').length)
                    //alert(default_country_code)
                    //alert(_currency_received_txt)

                })

        });


    </script>


{% endblock %}